#summary DBSetupHarness information

= Introduction =

The {{{DBSetupHarness}}} is used to work with flat xml (like dbunit) or sql to load a database.  


= Configuration =
Configuration parameters:
 * 'url' = url of the database used by dbunit.  see dbunit docs on {{{JdbcDatabaseTester}}}
 * 'user' = user to log into the db
 * 'password' = user's password
 * 'driver' = jdbc driver class
 * 'type' = type of dbunit operation (only used for flat xml file loading)
  ** CLEAN_INSERT (delete and reinsert rows)
  ** DELETE (only delete rows defined by xml)
  ** DELETE_ALL (delete all rows defined by tables in xml)
  ** INSERT (insert data in xml)
  ** REFRESH (insert new rows into db, update existing)
  ** TRUNCATE (truncate tables)
  ** UPDATE (update rows defined in xml)

= Parameter =
If a specified file parameter ends with 'sql', then the sql is executed against the database.  If the file parameter ends with 'xml', then dbunit is used to insert the flat file data into the db.

= Sample Usage =
{{{
    <Setup type="org.mash.harness.db.DBSetupHarness">
        <Configuration name="url" property="jdbc.url"/>
        <Configuration name="user" property="jdbc.user"/>
        <Configuration name="password" property="jdbc.pass"/>
        <Configuration name="driver" property="jdbc.driver"/>
        <Configuration name="type"><Value>clean_insert</Value></Configuration>
        <Parameter name="loadfile" file="data/db_load.xml">
            <Replace search="VARIABLE">
                <Value>sometext</Value>
            </Replace>
        </Parameter>
    </Setup>

    <Setup type="org.mash.harness.db.DBSetupHarness">
        <Configuration name="url" property="jdbc.url"/>
        <Configuration name="user" property="jdbc.user"/>
        <Configuration name="password" property="jdbc.pass"/>
        <Configuration name="driver" property="jdbc.driver"/>
        <Parameter name="loadfile" file="data/another_load.sql">
            <Replace search="VARIABLE">
                <Value>sometext</Value>
            </Replace>
        </Parameter>
    </Setup>
}}}

Here the db_load.xml is loaded, and every instance of 'VARIABLE' is replaced with 'sometext'.  Then the data is loaded (first by removing the specified rows in the xml) per the DBUnit rules.  This DOES use DBUnit to run the load and only works with flat xml data sets.  

The second call runs an sql file, and replaces every instance of 'VARIABLE' in that script first.